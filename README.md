# Учебная Виртуальная Машина (УВМ) - Ассемблер и Интерпретатор

Проект реализует полный цикл разработки для учебной виртуальной машины (УВМ):
- **ассемблер** — трансляция исходного кода в машинный код,
- **интерпретатор** — выполнение скомпилированных программ,
- **тестирование** — проверка всех компонентов системы.

## Архитектура УВМ

УВМ имеет следующие характеристики:
- **Стек** — для хранения промежуточных значений (максимум 256 элементов)
- **Память данных** — массив из 256 ячеек для хранения значений
- **Регистры** — специальные ячейки для управления выполнением

### Набор команд УВМ

УВМ поддерживает 4 базовые команды:

| Команда | Описание | Формат |
|---------|----------|--------|
| `LOAD_CONST` | Загрузка константы на вершину стека | `load <значение>` |
| `READ_MEM` | Чтение из памяти по адресу (стек[-1] + смещение) | `read <смещение>` |
| `WRITE_MEM` | Запись значения с вершины стека в память | `write <адрес>` |
| `SGN` | Вычисление знака числа из памяти | `sgn` |

---

## Форматы исходного кода

### 1. Текстовый формат (`.asm`, `.txt`)

Каждая строка содержит одну команду. Поддерживаются комментарии (начинаются с `#`).

**Пример программы:**
```asm
# Пример программы для УВМ
# Загружаем константу 42
load 42

# Читаем из памяти по адресу (42 + 5) = 47
read 5

# Записываем результат в ячейку 100
write 100

# Вычисляем знак числа из ячейки 100
sgn

# Работаем с разными системами счисления
load 0xFF      # hex
load 0b1010    # binary
load -15       # отрицательное число
```

### 2. YAML-формат (`.yaml`, `.yml`)

Более структурированный формат с явным определением программы.

**Пример YAML-файла:**
```yaml
# Программа для учебной виртуальной машины
program:
  - instruction: load
    value: 468
    comment: "Загрузка начального значения"
    
  - instruction: read
    offset: 15
    comment: "Чтение из памяти по смещению"
    
  - instruction: write
    address: 224
    comment: "Запись результата в память"
    
  - instruction: sgn
    comment: "Определение знака числа"
    
metadata:
  author: "Студент ИУ7"
  version: "1.0"
  description: "Тестовая программа для УВМ"
```

---

## Формат дампа памяти

### 1. Полный дамп (JSON)

```json
{
  "memory_state": {
    "timestamp": "2024-01-15T14:30:00Z",
    "total_cells": 256,
    "non_zero_cells": 12,
    "data_range": {
      "min_address": 0,
      "max_address": 255
    },
    "memory_map": {
      "0-31": {
        "description": "Системные ячейки",
        "values": {
          "0": 0, "1": 255, "2": 128, "3": 0,
          "4": 1, "5": 0, "6": 42, "7": 0
        }
      },
      "100-105": {
        "description": "Данные программы",
        "values": {
          "100": 1,
          "101": -1,
          "102": 0,
          "103": 42,
          "104": 255,
          "105": 128
        }
      }
    }
  }
}
```

### 2. Компактный дамп

```json
{
  "memory_snapshot": {
    "range": {
      "start": 100,
      "end": 106,
      "size": 6
    },
    "checksum": "a1b2c3d4e5",
    "contents": [
      {"address": 100, "value": 1, "hex": "0x01", "binary": "0b00000001"},
      {"address": 101, "value": -1, "hex": "0xFF", "binary": "0b11111111"},
      {"address": 102, "value": 0, "hex": "0x00", "binary": "0b00000000"},
      {"address": 103, "value": 42, "hex": "0x2A", "binary": "0b00101010"},
      {"address": 104, "value": 255, "hex": "0xFF", "binary": "0b11111111"},
      {"address": 105, "value": 128, "hex": "0x80", "binary": "0b10000000"}
    ]
  }
}
```

### 3. Текстовый дамп (человекочитаемый)

```
Memory Dump - УВМ (Учебная Виртуальная Машина)
===============================================
Time: 2024-01-15 14:30:00
Total cells: 256 (0x0000 - 0x00FF)

Address Range: 0x0064 - 0x0069 (100-105)
-----------------------------------------
[0x0064] 100:     1  (0x01)    0b00000001  [POSITIVE]
[0x0065] 101:    -1  (0xFF)    0b11111111  [NEGATIVE]
[0x0066] 102:     0  (0x00)    0b00000000  [ZERO]
[0x0067] 103:    42  (0x2A)    0b00101010  [POSITIVE]
[0x0068] 104:   255  (0xFF)    0b11111111  [NEGATIVE]
[0x0069] 105:   128  (0x80)    0b10000000  [NEGATIVE]

Statistics:
- Positive values: 2
- Negative values: 3
- Zero values: 1
- Min value: -1
- Max value: 255
- Average: 65.8
```

---

## Машинный код

Внутреннее представление команд:

```
LOAD_CONST:  [0x01][значение (2 байта)]
READ_MEM:    [0x02][смещение (1 байт)]
WRITE_MEM:   [0x03][адрес (1 байт)]
SGN:         [0x04]
```

**Пример машинного кода:**
```
01 002A    # load 42
02 05      # read 5
03 64      # write 100
04         # sgn
```

---

## Работа системы

1. **Ассемблер**:
   - Чтение исходного кода (.asm или .yaml)
   - Лексический и синтаксический анализ
   - Генерация машинного кода
   - Проверка границ памяти и стека

2. **Интерпретатор**:
   - Загрузка машинного кода
   - Инициализация памяти и стека
   - Пошаговое выполнение команд
   - Контроль ошибок выполнения

3. **Тестирование**:
   - Юнит-тесты для каждой команды
   - Интеграционные тесты
   - Проверка граничных условий
   - Тесты производительности

---

## Обработка ошибок

Система обнаруживает следующие типы ошибок:
1. **Синтаксические** — неверный формат команд
2. **Семантические** — недопустимые значения операндов
3. **Времени выполнения** — переполнение стека, выход за границы памяти
4. **Форматные** — ошибки в файлах конфигурации

---

Эта архитектура обеспечивает гибкость в использовании различных форматов ввода/вывода при сохранении совместимости с исходными требованиями.
